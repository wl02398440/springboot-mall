<!DOCTYPE html>
<html lang="zh-TW" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>我的訂單</title>
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../css/orderUser.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div id="app">
    <header>
        <div class="header-left">
            <a href="index.html" class="logo">SIMPLESHOP</a>
            <a href="productMall.html" class="nav-item">商場</a>
            <div class="nav-item-order">我的訂單</div>
        </div>

        <nav class="nav-links">
            <span class="user">{{ currentUser }}</span>

            <div class="cart-wrapper">
                <div class="cart-icon" @click="goShopcart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge" v-if="cart.length > 0">{{ cart.length }}</span>
                </div>

                <div class="mini-cart-dropdown">
                    <div class="empty-cart" v-if="cart.length === 0">
                        <p>尚未選購商品</p>
                    </div>

                    <div class="has-items" v-else>

                        <ul class="mini-list">
                            <li v-for="(item, index) in cart" :key="index" class="mini-item">
                                <img :src="item.imageUrl" class="item-img">
                                <div class="item-info">
                                    <div class="item-name">{{ item.productName }}</div>
                                    <div class="item-price">${{ item.price }}</div>
                                </div>
                                <div class="item-count">x {{ item.count }}</div>
                                <div class="delete-btn" @click="handleDelete(item.productId)" >
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                            </li>
                        </ul>

                        <div class="mini-footer">
                            <div class="total-text">{{ cart.length }} 件商品</div>
                            <button class="btn-checkout" @click="goShopcart">查看我的購物車</button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn" @click="logout">登出</button>
        </nav>
    </header>

    <div class="container">
        <h2 class="page-title">訂單列表</h2>

        <div class="item_header item_h">
            <div class="col-id">訂單編號</div>
            <div class="col-price">訂單總價</div>
            <div class="col-date">下單時間</div>
            <div class="col-detail">商品明細</div>
            <div class="col-status">狀態</div>
            <div class="col-operate">操作</div>
        </div>

        <div v-for="order in orderList" :key="order.orderId" class="item_header item_body">

            <div class="col-id">#{{ order.orderId }}</div>

            <div class="col-price">NT$ {{ order.totalAmount }}</div>

            <div class="col-date">{{ formatDate(order.lastModifiedDate) }}</div>

            <div class="col-detail">
                <button class="btn-detail" @click="viewDetail(order.orderId)">
                    <i class="fas fa-eye"></i> 詳情
                </button>
            </div>

            <div class="col-status">
                <span :class="['status-badge', getStatusClass(order.status)]">
                    {{ order.status }}
                </span>
            </div>

            <div class="col-operate">
                <template v-if="order.status === '未付款'">
                    <button class="btn-detail btn-pay" @click="checkout(order.orderId, order.totalAmount)">
                        付款
                    </button>
                    <button class="btn-detail btn-cancel" @click="cancelOrder(order.orderId)">
                        取消訂單
                    </button>
                </template>
                <template v-else>
                    ---
                </template>
            </div>
        </div>

        <div v-if="orderList.length === 0" class="empty-msg">
            目前沒有任何訂單
        </div>

        <transition name="fade">
            <div class="modal-overlay" v-if="showModal" @click.self="closeModal">
                <div class="modal-content order-modal">
                    <span class="close-btn" @click="closeModal">&times;</span>

                    <h3 class="modal-title">訂單明細 #{{ currentOrder.orderId }}</h3>

                    <div class="order-summary-info">
                        <div class="order-second">買家編號：{{ currentOrder.userId }}</div>
                        <div class="order-second">總金額：<span style="color: #e44b4b; font-weight: bold;">${{ currentOrder.totalAmount }}</span></div>
                    </div>

                    <div class="order-item-list">
                        <div class="order-item-header">
                            <span style="flex:1;">商品資訊</span>
                            <span style="width: 80px; text-align:center;">數量</span>
                            <span style="width: 100px; text-align:right;">小計</span>
                        </div>

                        <div v-for="(item, index) in currentOrderItems" :key="index" class="order-item">
                            <img :src="item.imageUrl" class="order-img">

                            <div class="order-info">
                                <div class="order-name">{{ item.productName }}</div>
                                <div class="order-price">${{ item.price }}</div>
                            </div>

                            <div class="order-count">x {{ item.count }}</div>

                            <div class="order-subtotal">${{ item.amount }}</div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn" @click="closeModal">關閉</button>
                    </div>
                </div>
            </div>
        </transition>
    </div>
</div>

<script src="../js/common.js"></script> <script src="../js/orderUser.js"></script>

</body>
</html>