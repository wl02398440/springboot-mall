<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>訂單管理</title>
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="../css/orderManage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div id="app">
    <header>
        <div class="header-left">
            <a href="home.html" class="logo">SIMPLESHOP</a>
            <a href="productManage.html" class="nav-item">商場管理</a>
            <div class="nav-item-order">訂單管理</div>
        </div>

        <nav class="nav-links">
            <span class="user">管理員：{{ currentUser }}</span>
            <button class="btn" @click="logout">登出</button>
        </nav>
    </header>

    <div class="container">
        <h2 class="page-title">訂單列表</h2>

        <div class="item_header item_h">
            <div class="col-id">訂單編號</div>
            <div class="col-user">用戶編號</div>
            <div class="col-price">訂單總價</div>
            <div class="col-date">最後修改時間</div>
            <div class="col-detail">商品明細</div>
            <div class="col-status">狀態</div>
            <div class="col-operate">操作</div>
        </div>

        <div v-for="order in orderList" :key="order.orderId" class="item_header item_body">

            <div class="col-id">#{{ order.orderId }}</div>

            <div class="col-user">
                <i class="fas fa-user-circle" style="color: #887538; margin-right: 5px;"></i>
                {{ order.userId }}
            </div>

            <div class="col-price">NT$ {{ order.totalAmount }}</div>

            <div class="col-date">{{ formatDate(order.lastModifiedDate) }}</div>

            <div class="col-detail">
                <button class="btn-detail" @click="viewDetail(order.orderId)">
                    <i class="fas fa-eye"></i> 詳情
                </button>
            </div>

            <div class="col-status">
                <span :class="['status-badge', getStatusClass(order.status)]">
                    {{ order.status }}
                </span>
            </div>

            <div class="col-operate">
                <template v-if="order.status === '已付款'">
                    <button class="btn-detail btn-shipped" @click="shipped(order.orderId)">
                        出貨
                    </button>
                </template>
                <template v-else-if="order.status === '未付款'">
                    <button class="btn-detail btn-cancel" @click="cancelOrder(order.orderId)">
                        取消訂單
                    </button>
                </template>
                <template v-else>
                    ---
                </template>
            </div>
        </div>

        <div v-if="orderList.length === 0" class="empty-msg">
            目前沒有任何訂單
        </div>

        <transition name="fade">
            <div class="modal-overlay" v-if="showModal" @click.self="closeModal">
                <div class="modal-content order-modal">
                    <span class="close-btn" @click="closeModal">&times;</span>

                    <h3 class="modal-title">訂單明細 #{{ currentOrder.orderId }}</h3>

                    <div class="order-summary-info">
                        <div class="order-second">買家編號：{{ currentOrder.userId }}</div>
                        <div class="order-second">總金額：<span style="color: #e44b4b; font-weight: bold;">${{ currentOrder.totalAmount }}</span></div>
                    </div>

                    <div class="order-item-list">
                        <div class="order-item-header">
                            <span style="flex:1;">商品資訊</span>
                            <span style="width: 80px; text-align:center;">數量</span>
                            <span style="width: 100px; text-align:right;">小計</span>
                        </div>

                        <div v-for="(item, index) in currentOrderItems" :key="index" class="order-item">
                            <img :src="item.imageUrl" class="order-img">

                            <div class="order-info">
                                <div class="order-name">{{ item.productName }}</div>
                                <div class="order-price">${{ item.price }}</div>
                            </div>

                            <div class="order-count">x {{ item.count }}</div>

                            <div class="order-subtotal">${{ item.amount }}</div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn" @click="closeModal">關閉</button>
                    </div>
                </div>
            </div>
        </transition>
    </div>
</div>

<script src="../js/common.js"></script> <script src="../js/orderManage.js"></script>

</body>
</html>