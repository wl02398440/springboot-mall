<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品列表</title>
<!--    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>-->
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="../css/productMall.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>

<div id="app">
<!--導覽列-->
    <header>
        <div class="header-left">
            <a href="home.html" class="logo">SIMPLESHOP</a>
            <a href="productMall.html" class="nav-item">商場</a>
            <a href="orderUser.html" class="nav-item-order">我的訂單</a>
        </div>

        <nav class="nav-links">
            <span class="user">{{ currentUser }}</span>

            <div class="cart-wrapper">
                <div class="cart-icon" @click="goShopcart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge" v-if="cart.length > 0">{{ cart.length }}</span>
                </div>

                <div class="mini-cart-dropdown">
                    <div class="empty-cart" v-if="cart.length === 0">
                        <p>尚未選購商品</p>
                    </div>

                    <div class="has-items" v-else>

                        <ul class="mini-list">
                            <li v-for="(item, index) in cart" :key="index" class="mini-item">
                                <img :src="item.imageUrl" class="item-img">
                                <div class="item-info">
                                    <div class="item-name">{{ item.productName }}</div>
                                    <div class="item-price">${{ item.price }}</div>
                                </div>
                                <div class="item-count">x {{ item.count }}</div>
                                <div class="delete-btn" @click="handleDelete(item.productId)" >
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                            </li>
                        </ul>

                        <div class="mini-footer">
                            <div class="total-text">{{ cart.length }} 件商品</div>
                            <button class="btn-checkout" @click="goShopcart">查看我的購物車</button>
                        </div>
                    </div>
                </div>
            </div>


            <button class="btn" @click="logout">登出</button>
        </nav>
    </header>
<!--搜尋列-->
    <div class="search-bar">
        <select v-model="selectedCategory" class="search-input">
            <option value="">所有種類</option>
            <option value="FOOD">食物</option>
            <option value="CAR">汽車</option>
            <option value="BOOK">書籍</option>
        </select>
        <input
                type="text"
                v-model="searchKeyword"
                placeholder="搜尋商品名稱..."
                class="search-input"
                @keyup.enter="searchProducts"
        >
        <button @click="searchProducts" class="btn btn-search">
            <i class="fas fa-search"></i> 搜尋
        </button>
        <button @click="clearSearch" class="btn btn-clear">
            <i class="fas fa-times"></i> 清空
        </button>
    </div>
<!--分頁列-->
    <div class="pagination-bar" v-if="totalPages > 1">
        <button class="btn-page" @click="changePage(currentPage - 1)"
                :disabled="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
        </button>
        <span
                v-for="page in totalPages"
                :key="page"
                class="page-number"
                :class="{ active: page === currentPage }"
                @click="changePage(page)"
        >{{ page }}
        </span>
        <button class="btn-page" @click="changePage(currentPage + 1)"
                :disabled="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
<!--商品列-->
    <div class="product-grid container">
        <div class="card" v-for="product in productList" :key="product.id">

            <div class="card-img-top">
                <img v-bind:src="product.imageUrl" alt="...">
            </div>

            <div class="card-body">
                <h5 class="card-title">{{ product.productName }}</h5>
                <div class="price-text">${{ product.price }}</div>
                <div class="stock-text">庫存:{{ product.stock }}</div>
                <div class="count">購買數量:
                    <button @click="subButton(product)">-</button>
                    <input
                            type="number"
                            class="count-input"
                            v-model.number="product.count"
                    >
                    <button @click="plusButton(product)">+</button>

                    <div v-if="product.showStockError" class="error-text">庫存不足!</div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn-add-cart" @click="addToCart(product)">
                    Add to cart
                </button>
            </div>

        </div>
    </div>
<!--分頁列-->
    <div class="pagination-bar" v-if="totalPages > 1">
        <button class="btn-page" @click="changePage(currentPage - 1)"
                :disabled="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
        </button>
        <span
                v-for="page in totalPages"
                :key="page"
                class="page-number"
                :class="{ active: page === currentPage }"
                @click="changePage(page)"
        >{{ page }}
        </span>
        <button class="btn-page" @click="changePage(currentPage + 1)"
                :disabled="currentPage === totalPages">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

</div>
<script src="../js/common.js"></script>
<script src="../js/productMall.js"></script>
</body>
</html>